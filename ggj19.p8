pico-8 cartridge // http://www.pico-8.com
version 16
__lua__

-- buttons
local left_btn = 0
local right_btn = 1
local up_btn = 2
local down_btn = 3
local a_btn = 4
local b_btn = 5

-- colors
local cl_black = 0
local cl_darkblue = 1
local cl_darkpurple = 2
local cl_darkgreen = 3
local cl_brown = 4
local cl_darkgray = 5
local cl_lightgray = 6
local cl_white = 7
local cl_red = 8
local cl_orange = 9
local cl_yellow = 10
local cl_green = 11
local cl_blue = 12
local cl_indigo = 13
local cl_pink = 14
local cl_peach = 15

local player
local cursor
local dummy_object
local dummies

function Player()
  local player = {
    x = 64,
    y = 64,
    vx = 2,
    vy = 2,
    sprite = 2
  }

  function player:update()
    if btn(right_btn) then
      self.x += self.vx
    end
    if btn(left_btn) then
      self.x -= self.vx
    end
    if btn(down_btn) then
      self.y += self.vy
    end
    if btn(up_btn) then
      self.y -= self.vy
    end
  end

  function player:draw()
    spr(player.sprite, player.x, player.y)
  end

  return player
end

function DummyObject(x, y)
  local dummy_object = {
    x = snap(x),
    y = snap(y),
    sprite = 3,
    draggable = false,
    dragged = false,
  }

  function dummy_object:update()
    if is_between(cursor, self) then
      self.draggable = true
    end

    if btn(a_btn) and self.draggable then
      if not(cursor.dragging) then
        cursor.dragging = self
      end
    else
      if cursor.dragging == self then
        cursor.dragging = false
      end
    end

    if not(is_between(cursor, self)) then
      self.draggable = false
    end
  end

  function dummy_object:draw()
    spr(self.sprite, self.x, self.y)
  end

  return dummy_object
end

function Cursor()
  local cursor = {
    x = 0,
    y = 0,
    color = cl_blue,
    dragging = false
  }

  function cursor:update()
    if btn(a_btn) then
      self.color = cl_red
    else
      self.color = cl_blue
    end
    self.x = snap(player.x)
    self.y = snap(player.y + 8)

    if self.dragging then
      self.dragging.x = self.x
      self.dragging.y = self.y
    end
  end

  function cursor:draw()
    rect(cursor.x, cursor.y, cursor.x + 8, cursor.y + 8, cursor.color)
  end

  return cursor
end

function snap(i)
  return flr(i / 8) * 8
end

function draw_grid()
 -- vertical lines
  for i = 0,120,8
  do
    line(i, 0, i, 128, cl_darkgray)
  end

-- horizontal lines
  for i = 0,120,8
  do
    line( 0, i, 128, i, cl_darkgray)
  end
end

function is_between(obj1, obj2)
 return obj1.x < (obj2.x + 8) and obj1.x >= obj2.x and obj1.y < (obj2.y + 8) and obj1.y >= obj2.y
end

function _init()
  player = Player()
  cursor = Cursor()
  dummies = {
    DummyObject(1, 2),
    DummyObject(2, 4),
    DummyObject(5, 1),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(7, 10),
    DummyObject(12, 2)
  }
end


function _update()
  player:update()
  cursor:update()
  foreach(dummies, function(dum) dum:update() end)
end

function _draw()
  cls() -- clears the screen
  draw_grid()
  cursor:draw()
  player:draw()
  foreach(dummies, function(dum) dum:draw() end)
end

__gfx__
00000000bbbbbbbb0000eeee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000008bb8b888000eeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007008888888800eeeeee00988890000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770008888884800eeeeee00199910000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000884888480eeee00000111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007004844884800ee000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000004444480000e0000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000440004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000099900000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000099900099000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000009900000000990000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000990000000000009000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000900000000000009000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000009000000000000000900000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000099000009000000000000000090000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000009900990090000000000000000090000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000090000090090000000000000000009000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000900000090900000000000000000000900000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000900000090900000000000000000000090000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000009000000090900000000000000000000090000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000009000000090900000000000000000000009000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000990000000090900000000000000000000009000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000009900000000000999999000009000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000009090000000999000009000009000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000009009900009000000000000009000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000009000099999999900000000009000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000009000000090009000000000009000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000009000000900090000000000009000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000009000009009900000000000009000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000009000009990000000000000009000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000009000099000000000000000009000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000900990000000000000000009000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000099900000000000000000090000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000900000000000000000090000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000900000000000000000090000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000900000000000000000090000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000900000009000000000900000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000900000000000000009900000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000090000000000000990000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000099000000000999000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000999999999000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100002205017050170501305014050170501905010050100501105019050130500e6501e05014050270501f460140701e0701d07023070150701d0701d07020070180701b070240501a0401c0501b0501b050
